/*!
 * froala_editor v2.0.5 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms
 * Copyright 2014-2015 Froala Labs
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(a,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(a)),e(t),t}:e(jQuery)}(function(e){"use strict";if(e.extend(e.FroalaEditor.DEFAULTS,{imageManagerLoadURL:"http://i.froala.com/load-files",imageManagerLoadMethod:"get",imageManagerLoadParams:{},imageManagerPreloader:"",imageManagerDeleteURL:"",imageManagerDeleteMethod:"post",imageManagerDeleteParams:{},imageManagerPageSize:12,imageManagerScrollOffset:20,imageManagerToggleTags:!0}),e.FroalaEditor.PLUGINS.imageManager=function(a){function t(){T.show(),E.show(),Q=a.image.get(),P||L(),g(),a.$document.find("body").addClass("prevent-scroll"),a.helpers.isMobile()&&a.$document.find("body").addClass("fr-mobile")}function i(){a.events.enableBlur(),T.hide(),E.hide(),a.$document.find("body").removeClass("prevent-scroll fr-mobile")}function r(){var a=e(window).outerWidth();return 768>a?2:1200>a?3:4}function n(){x.empty();for(var e=0;j>e;e++)x.append('<div class="fr-list-column"></div>')}function o(){var t="";a.opts.theme&&(t=" "+a.opts.theme+"-theme");var i='<div class="fr-modal'+t+'"><div class="fr-modal-wrapper">';return i+='<div class="fr-modal-title"><div class="fr-modal-title-line"><i class="fa fa-bars fr-modal-more fr-not-available" id="fr-modal-more-'+a.id+'" title="'+a.language.translate("Tags")+'"></i><h4 data-text="true">'+a.language.translate("Manage Images")+'</h4><i title="'+a.language.translate("Cancel")+'" class="fa fa-times fr-modal-close" id="fr-modal-close-'+a.id+'"></i></div>',i+='<div class="fr-modal-tags" id="fr-modal-tags-'+a.id+'"></div>',i+="</div>",i+='<img class="fr-preloader" id="fr-preloader-'+a.id+'" alt="'+a.language.translate("Loading")+'.." src="'+a.opts.imageManagerPreloader+'" style="display: none;">',i+='<div class="fr-scroller" id="fr-scroller-'+a.id+'"><div class="fr-image-list" id="fr-image-list-'+a.id+'"></div></div>',i+="</div></div>",e(i)}function s(){T=o(),a.helpers.isMobile()||T.addClass("fr-desktop"),T.appendTo("body"),E=e('<div class="fr-overlay">').appendTo("body"),a.opts.theme&&E.addClass(a.opts.theme+"-theme"),i(),a.events.on("destroy",function(){T.removeData().remove(),E.removeData().remove()},!0)}function g(){P.show(),x.find(".fr-list-column").empty(),a.opts.imageManagerLoadURL?e.ajax({url:a.opts.imageManagerLoadURL,method:a.opts.imageManagerLoadMethod,data:a.opts.imageManagerLoadParams,dataType:"json"}).done(function(e,t,i){a.events.trigger("imageManager.imagesLoaded",[e]),l(e,i.response),P.hide()}).fail(function(){var e=this.xhr();M(z,e.response||e.responseText)}):M($)}function l(e,a){try{x.find(".fr-list-column").empty(),S=0,R=0,k=0,H=e,d()}catch(t){M(B,a)}}function d(){if(R<H.length&&(x.outerHeight()<=I.outerHeight()+a.opts.imageManagerScrollOffset||I.scrollTop()+a.opts.imageManagerScrollOffset>x.outerHeight()-I.outerHeight())){S++;for(var e=a.opts.imageManagerPageSize*(S-1);e<Math.min(H.length,a.opts.imageManagerPageSize*S);e++)f(H[e])}}function f(t){var i=new Image,r=e('<div class="fr-image-container fr-empty fr-image-'+k++ +'" data-loading="'+a.language.translate("Loading")+'.." data-deleting="'+a.language.translate("Deleting")+'..">');p(!1),i.onload=function(){r.height(Math.floor(r.width()/i.width*i.height));var n=e("<img/>");if(t.thumb)n.attr("src",t.thumb);else{if(M(_,t),!t.url)return M(A,t),!1;n.attr("src",t.url)}if(t.url&&n.attr("data-url",t.url),t.tag)if(U.find(".fr-modal-more.fr-not-available").removeClass("fr-not-available"),U.find(".fr-modal-tags").show(),t.tag.indexOf(",")>=0){for(var o=t.tag.split(","),s=0;s<o.length;s++)o[s]=o[s].trim(),0===F.find('a[title="'+o[s]+'"]').length&&F.append('<a role="button" title="'+o[s]+'">'+o[s]+"</a>");n.attr("data-tag",o.join())}else 0===F.find('a[title="'+t.tag.trim()+'"]').length&&F.append('<a role="button" title="'+t.tag.trim()+'">'+t.tag.trim()+"</a>"),n.attr("data-tag",t.tag.trim());for(var g in t)"thumb"!=g&&"url"!=g&&"tag"!=g&&n.attr("data-"+g,t[g]);r.append(n).append('<i class="fa fa-trash-o fr-delete-img" title="'+a.language.translate("Delete")+'"></i>').append('<i class="fa fa-plus fr-insert-img" title="'+a.language.translate("Insert")+'"></i>'),F.find(".fr-selected-tag").each(function(e,a){C(n,a.text)||r.hide()}),n.on("load",function(){r.removeClass("fr-empty"),r.height("auto"),R++;var e=c(parseInt(n.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);u(e),p(!1),R%a.opts.imageManagerPageSize===0&&d()}),a.events.trigger("imageManager.imageLoaded",[n])},i.onerror=function(){R++,r.remove();var e=c(parseInt(r.attr("class").match(/fr-image-(\d+)/)[1],10)+1);u(e),M(q,t),R%a.opts.imageManagerPageSize===0&&d()},i.src=t.url,m().append(r)}function m(){var a,t;return x.find(".fr-list-column").each(function(i,r){var n=e(r);0===i?(t=n.outerHeight(),a=n):n.outerHeight()<t&&(t=n.outerHeight(),a=n)}),a}function c(a){void 0===a&&(a=0);for(var t=[],i=k-1;i>=a;i--){var r=x.find(".fr-image-"+i);r.length&&(t.push(r),e('<div id="fr-image-hidden-container">').append(r),x.find(".fr-image-"+i).remove())}return t}function u(e){for(var a=e.length-1;a>=0;a--)m().append(e[a])}function p(e){if(void 0===e&&(e=!0),!T.is(":visible"))return!0;var t=r();if(t!=j){j=t;var i=c();n(),u(i)}var o=a.$window.height(),s=T.find(".fr-modal-wrapper"),g=parseFloat(s.css("margin-top"))+parseFloat(s.css("margin-bottom")),l=parseFloat(s.css("padding-top"))+parseFloat(s.css("padding-bottom")),f=parseFloat(s.css("border-top-width")),m=s.find("h4").outerHeight();I.height(Math.min(x.outerHeight(),o-g-l-m-f)),e&&d()}function h(t){var r=e(t.currentTarget).siblings("img");if(i(),a.image.showProgressBar(),Q)Q.trigger("click");else{a.events.focus(!0),a.selection.restore();var n=a.position.getBoundingRect(),o=n.left+n.width/2,s=n.top+n.height;a.popups.setContainer("image.insert",a.$box||e("body")),a.popups.show("image.insert",o,s)}var g={},l=r.data();for(var d in l)"url"!=d&&"tag"!=d&&(g[d]=l[d]);a.image.insert(r.data("url"),!1,g,Q)}function v(t){var i=e(t.currentTarget).siblings("img"),r=a.language.translate("Are you sure? Image will be deleted.");confirm(r)&&(a.opts.imageManagerDeleteURL?a.events.trigger("imageManager.beforeDeleteImage",[i])!==!1&&(i.parent().addClass("fr-image-deleting"),e.ajax({method:a.opts.imageManagerDeleteMethod,url:a.opts.imageManagerDeleteURL,data:e.extend({src:i.attr("src")},a.opts.imageManagerDeleteParams)}).done(function(e){a.events.trigger("imageManager.imageDeleted",[e]);var t=c(parseInt(i.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);i.parent().remove(),u(t),p(!0)}).fail(function(){var e=this.xhr();M(N,e.response||e.responseText)})):M(O))}function M(t,i){t>=10&&20>t?P.hide():t>=20&&30>t&&e(".fr-image-deleting").removeClass("fr-image-deleting"),a.events.trigger("imageManager.error",[{code:t,message:G[t]},i])}function b(){var e=U.find(".fr-modal-title-line").outerHeight(),a=F.outerHeight();U.toggleClass(".fr-show-tags"),U.hasClass(".fr-show-tags")?(U.css("height",e+a),F.find("a").css("opacity",1)):(U.css("height",e),F.find("a").css("opacity",0))}function w(){var a=F.find(".fr-selected-tag");a.length>0?(x.find("img").parent().show(),a.each(function(a,t){x.find("img").each(function(a,i){var r=e(i);C(r,t.text)||r.parent().hide()})})):x.find("img").parent().show();var t=c();u(t),d()}function y(t){t.preventDefault();var i=e(t.currentTarget);i.toggleClass("fr-selected-tag"),a.opts.imageManagerToggleTags&&i.siblings("a").removeClass("fr-selected-tag"),w()}function C(e,a){for(var t=e.attr("data-tag").split(","),i=0;i<t.length;i++)if(t[i]==a)return!0;return!1}function L(){P=T.find("#fr-preloader-"+a.id),x=T.find("#fr-image-list-"+a.id),I=T.find("#fr-scroller-"+a.id),F=T.find("#fr-modal-tags-"+a.id),U=F.parent(),j=r(),n();var t=U.find(".fr-modal-title-line").outerHeight();U.css("height",t),I.css("margin-top",t),a.events.bindClick(T,"i#fr-modal-close-"+a.id,i),e(window).on("resize.imagemanager"+a.id,p),a.helpers.isMobile()&&(a.events.bindClick(x,"div.fr-image-container",function(a){T.find(".fr-mobile-selected").removeClass("fr-mobile-selected"),e(a.currentTarget).addClass("fr-mobile-selected")}),T.on(a._mousedown,function(){T.find(".fr-mobile-selected").removeClass("fr-mobile-selected")})),a.events.bindClick(x,".fr-insert-img",h),a.events.bindClick(x,".fr-delete-img",v),T.on(a._mousedown+" "+a._mouseup,function(e){e.stopPropagation()}),T.on(a._mousedown,"*",function(){a.events.disableBlur()}),I.on("scroll",d),a.events.bindClick(T,"i#fr-modal-more-"+a.id,b),a.events.bindClick(F,"a",y),a.events.on("destroy",function(){e(window).off("resize.imagemanager"+a.id)},!0)}function D(){return a.$wp||"IMG"==a.$el.get(0).tagName?void s():!1}var T,P,x,I,F,U,E,H,S,R,k,j,q=10,z=11,$=12,B=13,_=14,A=15,N=21,O=22,G={};G[q]="Image cannot be loaded from the passed link.",G[z]="Error during load images request.",G[$]="Missing imageManagerLoadURL option.",G[B]="Parsing load response failed.",G[_]="Missing image thumb.",G[A]="Missing image URL.",G[N]="Error during delete image request.",G[O]="Missing imageManagerDeleteURL option.";var Q;return{require:["image"],_init:D,show:t,hide:i}},!e.FroalaEditor.PLUGINS.image)throw new Error("Image manager plugin requires image plugin.");e.FroalaEditor.DEFAULTS.imageInsertButtons.push("imageManager"),e.FroalaEditor.RegisterCommand("imageManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.imageManager.show()}}),e.FroalaEditor.DefineIcon("imageManager",{NAME:"fa fa-folder"})});